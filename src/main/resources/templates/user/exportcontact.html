<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}">

<head>
    <title th:text="${loggedInUser.name} + ' | Export Contacts'">Export Contacts</title>
</head>

<body>

    <div id="content" class="pt-20 sm:ml-64 lg:ml-80 px-6">

        <!-- ================= HEADER ================= -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">

            <div>
                <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white">
                    Export Contacts
                </h1>
                <p class="text-gray-500 dark:text-gray-400">
                    Select contacts and export them to Excel
                </p>
            </div>

            <div>
                <button onclick="exportAllContacts()" class="px-6 py-3 rounded-xl
                        bg-gradient-to-r from-blue-600 to-indigo-600
                        hover:from-blue-700 hover:to-indigo-700
                        text-white font-semibold shadow-lg">
                    <i class="fa-solid fa-layer-group mr-2"></i>
                    Export All
                </button>

                <button onclick="exportSelectedContacts()" class="px-6 py-3 rounded-xl
                       bg-gradient-to-r from-green-600 to-emerald-600
                       hover:from-green-700 hover:to-emerald-700
                       text-white font-semibold shadow-lg">
                    <i class="fa-solid fa-file-excel mr-2"></i>
                    Export
                </button>

                <button onclick="resetExportSelection()" class="mt-2 px-6 py-3 rounded-xl
                        bg-gradient-to-r from-red-400 to-red-600
                        hover:bg-gradient-to-br dark:focus:ring-red-800
                        text-white font-semibold shadow-lg">
                    <i class="fa-solid fa-rotate-right"></i>
                </button>
            </div>

        </div>

        <!-- ================= TOOLBAR ================= -->
        <div class="bg-white dark:bg-gray-900 p-5 rounded-lg mb-4">

            <form th:action="@{/exportcontacts/search}" method="get" class="flex flex-wrap gap-4 items-center">

                <select name="field"
                    class="px-4 py-2 rounded-lg border dark:bg-gray-800 dark:border-gray-600 dark:text-white">
                    <option disabled selected>Filter by</option>
                    <option value="name" th:selected="${field=='name'}">Name</option>
                    <option value="phone" th:selected="${field=='phone'}">Phone</option>
                    <option value="email" th:selected="${field=='email'}">Email</option>
                </select>

                <input type="search" name="keyword" th:value="${keyword}" placeholder="Search contacts..."
                    class="px-4 py-2 w-72 rounded-lg border dark:bg-gray-800 dark:text-white dark:border-gray-600">

                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">
                    Search
                </button>
            </form>
        </div>

        <!-- ================= NO CONTACTS ================= -->
        <div th:if="${contacts == null or contacts.empty}" class="flex flex-col items-center justify-center py-24">

            <i class="fa-solid fa-address-book text-6xl text-blue-500 mb-6"></i>

            <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2">
                No Contacts Found
            </h2>

            <p class="text-gray-500 dark:text-gray-400 mb-6">
                Add contacts or change your search filters.
            </p>

            <a th:href="@{/addcontact}" class="px-6 py-3 bg-blue-600 text-white rounded-lg">
                Add Contact
            </a>
        </div>

        <!-- ================= TABLE ================= -->
        <div class="relative overflow-x-auto w-full">
            <table id="contact-table" th:if="${contacts != null and !contacts.empty}"
                class="min-w-max w-full text-sm text-left text-gray-500 dark:text-gray-400">


                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        <th class="px-4 py-3 text-center">
                            <input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)" class="w-4 h-4">
                        </th>
                        <th class="px-6 py-3">Contact</th>
                        <th class="px-6 py-3">Phone</th>
                        <th class="px-6 py-3 text-center">Info</th>
                    </tr>
                </thead>

                <tbody>
                    <tr th:each="c : ${contacts.content}"
                        class="bg-white dark:bg-gray-800 border-b border-b  dark:border-gray-700 border-gray-200 dark:hover:bg-gray-600">

                        <!-- Checkbox -->
                        <td class="px-4 py-4 text-center">
                            <input type="checkbox" class="rowCheckbox" th:value="${c.id}" th:data-name="${c.name}"
                                th:data-email="${c.email}" th:data-phone="${c.phone}" th:data-address="${c.address}"
                                th:data-message="${c.message}" th:data-fav="${c.favourite}"
                                th:data-website="${c.websiteLink}" th:data-linkedin="${c.linkedInLink}"
                                th:data-picture="${c.picture}" onchange="handleRowSelection(this)">
                        </td>

                        <!-- Contact -->
                        <td class="px-6 py-4 flex items-center gap-3">

                            <img th:src="@{${c.picture}}" onerror="this.src='/images/default_contact.png'"
                                class="w-10 h-10 rounded-full" />

                            <div>
                                <div class="font-semibold export-name dark:text-white" th:text="${c.name}"></div>

                                <div class="text-sm text-gray-500 export-email dark:text-gray-400" th:text="${c.email}">
                                </div>
                            </div>

                            <!-- Hidden export / popup data -->
                            <span class="hidden export-phone" th:text="${c.phone}"></span>
                            <span class="hidden export-address" th:text="${c.address}"></span>
                            <span class="hidden export-message" th:text="${c.message}"></span>
                            <span class="hidden export-fav" th:text="${c.favourite ? 'TRUE' : 'FALSE'}"></span>
                            <span class="hidden export-website" th:text="${c.websiteLink}"></span>
                            <span class="hidden export-linkedin" th:text="${c.linkedInLink}"></span>
                        </td>

                        <!-- Phone -->
                        <td class="px-6 py-4">
                            <i class="fa-solid fa-phone me-1"></i>
                            <span th:text="${c.phone}"></span>
                        </td>

                        <!-- Info -->
                        <td class="px-6 py-4 text-center">
                            <button type="button" class="text-blue-600 hover:text-blue-800" th:data-id="${c.id}"
                                onclick="openExportInfoModal(this)">
                                <i class="fa-solid fa-circle-info text-lg"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- ================= CONTACT MODAL ================= -->
            <div th:replace="~{ user/contact_modals :: contact }"></div>

        </div>
        <!-- ================= PAGINATION ================= -->
        <div th:if="${contacts != null and !contacts.empty and contacts.totalPages > 1}"
            class="p-2 flex justify-center">

            <nav aria-label="Page navigation">
                <ul class="flex items-center -space-x-px h-10 text-base">

                    <!-- Previous -->
                    <li th:unless="${contacts.first}">
                        <a th:href="@{'/exportcontacts?page=' + ${contacts.number-1}}" class="flex items-center justify-center px-4 h-10 ms-0 leading-tight
                  text-gray-500 bg-white border border-e-0 border-gray-300
                  rounded-s-lg hover:bg-gray-100 hover:text-gray-700
                  dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400
                  dark:hover:bg-gray-700 dark:hover:text-white">
                            <span class="sr-only">Previous</span>
                            <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                                fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="M5 1 1 5l4 4" />
                            </svg>
                        </a>
                    </li>

                    <!-- Page Numbers -->
                    <li th:each="index : ${#numbers.sequence(
            T(java.lang.Math).max(0, contacts.number - 2),
            T(java.lang.Math).min(contacts.totalPages - 1, contacts.number + 2)
          )}">
                        <a th:href="@{'/exportcontacts?page=' + ${index}}" th:text="${index + 1}" th:classappend="${index == contacts.number}
             ? 'bg-blue-50 text-blue-600 dark:bg-gray-600 dark:text-white'
             : 'bg-white dark:bg-gray-800'" class="flex items-center justify-center px-4 h-10 leading-tight
                  text-gray-500 border border-gray-300
                  hover:bg-gray-100 hover:text-gray-700
                  dark:border-gray-700 dark:text-gray-400
                  dark:hover:bg-gray-700 dark:hover:text-white">
                        </a>
                    </li>

                    <!-- Next -->
                    <li th:unless="${contacts.last}">
                        <a th:href="@{'/exportcontacts?page=' + ${contacts.number+1}}" class="flex items-center justify-center px-4 h-10 leading-tight
                  text-gray-500 bg-white border border-gray-300
                  rounded-e-lg hover:bg-gray-100 hover:text-gray-700
                  dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400
                  dark:hover:bg-gray-700 dark:hover:text-white">
                            <span class="sr-only">Next</span>
                            <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                                fill="none" viewBox="0 0 6 10">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                    stroke-width="2" d="m1 9 4-4-4-4" />
                            </svg>
                        </a>
                    </li>

                </ul>
            </nav>
        </div>


        <!-- ================= SCRIPTS ================= -->
        <script src="https://cdn.jsdelivr.net/npm/@linways/table-to-excel@1.0.4/dist/tableToExcel.min.js"></script>
        <script th:src="@{'/js/export_contact.js'}"></script>
        <script th:src="@{'/js/admin.js'}"></script>

</body>

</html>