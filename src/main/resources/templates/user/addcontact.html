<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
  th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}">

<head>
  <title th:text="${loggedInUser.name} + ' | Add Contact'">Add Contact</title>
</head>

<body>
  <div id="content" class="pt-20 sm:ml-64 lg:ml-80 px-6">
    <div class="flex justify-center">
      <div class="w-full max-w-2xl xl:max-w-3xl">
        <div class="block p-6 border-t-[8px] border-b-[8px] border-l-[2px] border-r-[2px]
                     bg-white border-blue-500 rounded-xl shadow-sm
                     dark:bg-gray-800 dark:border-blue-500">

          <!-- FORM (reduced top margin) -->
          <form class="space-y-4 mt-4" th:action="@{'/do-add'}" method="post" th:object="${contactForm}"
            enctype="multipart/form-data" novalidate>

            <!-- Message Box -->
            <div th:replace="~{user/addContactMessage::messagebox}"></div>

            <!-- HEADER + FAVORITE -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">

              <!-- Title -->
              <div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-1">
                  Add New Contact
                </h1>
                <p class="text-gray-500 dark:text-gray-400">
                  Store your contact safely on cloud
                </p>
              </div>

              <!-- Favorite Card -->
              <div class="w-full sm:w-60 p-3 rounded-lg
                         bg-pink-50 border border-pink-200
                         dark:bg-pink-900/20 dark:border-pink-700">
                <div class="flex flex-col items-center text-center gap-2">

                  <div class="flex items-center justify-center w-10 h-10 rounded-full
                             bg-pink-100 text-pink-600
                             dark:bg-pink-800/40 dark:text-pink-400">
                    <i class="fa-solid fa-heart"></i>
                  </div>

                  <div>
                    <p class="text-sm font-semibold text-gray-900 dark:text-white">
                      Favorite Contact
                    </p>
                    <p class="text-xs text-gray-600 dark:text-gray-400">
                      Mark this contact as important
                    </p>
                  </div>

                  <!-- Toggle -->
                  <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only peer" th:field="*{favourite}" id="favourite">

                    <div class="relative w-10 h-5 rounded-full
                              bg-gray-300
                              peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300
                              dark:bg-gray-600 dark:peer-focus:ring-pink-800
                              transition-colors duration-300
                              peer-checked:bg-pink-500

                              after:content-['']
                              after:absolute after:top-[2px] after:left-[2px]
                              after:w-4 after:h-4 after:bg-white after:rounded-full
                              after:transition-all after:duration-300 after:ease-in-out
                              peer-checked:after:translate-x-[20px]"></div>
                  </label>
                </div>
              </div>
            </div>

            <!-- Name -->
            <div>
              <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Name</label>
              <div class="relative">
                <i
                  class="fa-regular fa-user absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"></i>
                <input type="text" th:field="*{name}" name="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                             focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5
                             dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter name" required>
              </div>
              <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}"
                class="mt-2 ml-1 text-sm text-red-600 dark:text-red-500"></p>
            </div>

            <!-- Email -->
            <div>
              <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email</label>
              <div class="relative">
                <i
                  class="fa-regular fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"></i>
                <input type="text" th:field="*{email}" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                             focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5
                             dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter email">
              </div>
              <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}"
                class="mt-2 ml-1 text-sm text-red-600 dark:text-red-500"></p>
            </div>

            <!-- Phone -->
            <div>
              <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Phone</label>
              <div class="relative">
                <i
                  class="fa-solid fa-phone absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"></i>
                <input type="text" th:field="*{phone}" id="phone" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                             focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5
                             dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter phone" required>
              </div>
              <p th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"
                class="mt-2 ml-1 text-sm text-red-600 dark:text-red-500"></p>
            </div>

            <!-- Address -->
            <div>
              <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Address</label>
              <div class="relative">
                <i class="fa-solid fa-location-dot absolute left-3 top-3 text-gray-500 dark:text-gray-400"></i>
                <textarea rows="3" th:field="*{address}" id="address" class="block p-2.5 pl-10 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300
                            focus:ring-blue-500 focus:border-blue-500
                            dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                  placeholder="Enter address"></textarea>
              </div>
              <p th:if="${#fields.hasErrors('address')}" th:errors="*{address}"
                class="mt-2 ml-1 text-sm text-red-600 dark:text-red-500"></p>
            </div>


            <!-- Message -->
            <div>
              <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Message</label>
              <div class="relative">
                <i class="fa-solid fa-comment-dots absolute left-3 top-3 text-gray-500 dark:text-gray-400"></i>
                <textarea rows="3" th:field="*{message}" id="message" class="block p-2.5 pl-10 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300
                            focus:ring-blue-500 focus:border-blue-500
                            dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                  placeholder="Write something..."></textarea>
              </div>
              <p th:if="${#fields.hasErrors('message')}" th:errors="*{message}"
                class="mt-2 ml-1 text-sm text-red-600 dark:text-red-500"></p>
            </div>

            <!-- Social Links -->
            <div class="flex gap-4">
              <div class="relative w-full">
                <i
                  class="fa-solid fa-earth-americas absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"></i>
                <input type="text" th:field="*{websiteLink}" id="websiteLink" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                             focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5
                             dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Website link">
              </div>

              <div class="relative w-full">
                <i
                  class="fa-brands fa-linkedin absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400"></i>
                <input type="text" th:field="*{linkedInLink}" id="linkedInLink" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg
                             focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5
                             dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="LinkedIn link">
              </div>
            </div>

            <!-- Image -->
            <div>
              <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Contact Image</label>
              <input type="file" th:field="*{picture}" id="picture" onchange="validateImageSize(this)" class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg
                  bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-400"
                accept="image/jpeg,image/png,image/webp">
              <p th:if="${#fields.hasErrors('picture')}" th:errors="*{picture}"
                class="mt-2 ml-1 text-sm text-red-600 dark:text-red-500"></p>
              <img class="mt-3 max-h-52 mx-auto rounded-lg " src="" id="upload_image_preview" alt="">
            </div>

            <!-- Image Size Popup -->
            <div id="imageSizePopup" class="hidden fixed inset-0 z-50 flex items-center justify-center
                      bg-black/50">

              <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg
                        max-w-sm w-full p-6 text-center">

                <div class="flex justify-center mb-3">
                  <div class="w-12 h-12 flex items-center justify-center
                            rounded-full bg-red-100 text-red-600">
                    <i class="fa-solid fa-circle-exclamation text-xl"></i>
                  </div>
                </div>

                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                  Image Too Large
                </h3>

                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                  Image size must be less than <strong>2 MB</strong>.
                </p>

                <button type="button" onclick="closeImagePopup()" class="px-5 py-2 text-sm font-medium text-white
                              bg-red-600 rounded-lg hover:bg-red-700">
                  OK
                </button>

              </div>
            </div>

            <!-- Buttons -->
            <div class="mt-8 flex justify-center space-x-5">
              <button type="submit" class="text-white bg-blue-700 hover:bg-green-700 focus:ring-4
                           focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5
                           dark:bg-blue-600 dark:hover:bg-green-700">
                Add Contact
              </button>

              <button type="reset" onclick="window.location.href='/addcontact'" class="text-white bg-blue-700 hover:bg-red-700 focus:ring-4
                           focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5
                           dark:bg-blue-600 dark:hover:bg-red-700">
                Reset
              </button>
            </div>

          </form>

        </div>
      </div>
    </div>
  </div>

  <script th:src="@{'/js/admin.js'}"></script>
  <script>
    console.log("Add Contact Page Loaded");
  </script>

</body>

</html>